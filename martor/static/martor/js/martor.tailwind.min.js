/**
 * Martor v1.6.45 (Tailwind CSS Version) - Minified
 * License: GNU GENERAL PUBLIC LICENSE Version 3, 29 June 2007
**/
!function(e){e=e||django.jQuery,e.fn.martor=function(){e(".martor").trigger("martor.init");var t={showElement:function(t){e(t).removeClass("hidden").addClass("block")},hideElement:function(t){e(t).removeClass("block").addClass("hidden")},showModal:function(t){e(t).removeClass("hidden").addClass("flex"),e("body").addClass("overflow-hidden")},hideModal:function(t){e(t).removeClass("flex").addClass("hidden"),e("body").removeClass("overflow-hidden")},toggleTab:function(t,n,o,r){e(o).removeClass("border-b-2 border-gray-800 text-gray-700").addClass("text-gray-500"),e(r).removeClass("block").addClass("hidden"),e(t).removeClass("text-gray-500").addClass("border-b-2 border-gray-800 text-gray-700"),e(n).removeClass("hidden").addClass("block")}},n=function(e){var t=null,n=0;if(document.cookie&&""!==document.cookie)for(var o=document.cookie.split(";");n<o.length;n++){var r=jQuery.trim(o[n]);if(r.substring(0,e.length+1)===e+"="){t=decodeURIComponent(r.substring(e.length+1));break}}return t};function o(e,t,n){var o=e.getSelectedText(),r=o||n,a=e.getSelectionRange();0===o.length?(e.session.replace(a,t+r+n),a.start.column+=t.length,e.moveCursorToPosition(a.start),e.clearSelection()):e.session.replace(a,t+r+n),e.focus()}function r(e,t,n){var o="!["+t+"]("+n+")",r=e.getSelectionRange();e.session.replace(r,o),e.focus()}function a(e,t){var n=t+" ",o=e.getSelectionRange();e.session.replace(o,n),e.focus()}function i(e){var t="@[username] ",n=e.getSelectionRange();e.session.replace(n,t);var o=n;o.start.column+=2,o.end.column+=10,e.selection.setRange(o),e.focus()}function c(o,r,i){var c=o.val(),l="true"==i.living;if(c.length>0){var s=o.data("save-timeout"),d=o.data("markdownfy-url");l||!r||r.html('<p class="text-center text-gray-500 py-8">Processing...</p>'),setTimeout(function(){e.ajax({url:d,type:"POST",data:{content:c,csrfmiddlewaretoken:n("csrftoken")},success:function(e){var n=e.content;r.html(n),r.addClass("martor-preview"),l||!r||r.animate({scrollTop:r[0].scrollHeight},800),"undefined"!=typeof hljs&&r.find("pre code").each(function(e,t){hljs.highlightBlock(t)})}})},s)}else r.html('<p class="text-gray-500">Nothing to preview</p>')}this.each(function(l,s){var d=e(s),u=d.data("field-name"),m=e("#id_"+u),f="martor-"+u,h=ace.edit(f),g=JSON.parse(m.data("enable-configs").replace(/'/g,'"'));h.setTheme("ace/theme/github"),h.getSession().setMode("ace/mode/markdown"),h.getSession().setUseWrapMode(!0),h.$blockScrolling=1/0,h.renderer.setScrollMargin(10,10),h.setAutoScrollEditorIntoView(!0),h.setShowPrintMargin(!1),h.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,enableMultiselect:!1}),"true"==g.living&&e(s).addClass("enable-living");var p={getCompletions:function(e,t,n,o,r){var a="undefined"!=typeof emojis?emojis:[],i=e.getSession().getTokenAt(n.row,n.column.count);if("undefined"!=typeof i.value){var c=i.value.split(/\s+/);c[c.length-1][0]==":"&&r(null,a.map(function(e){return{caption:e,value:e.replace(":","")+" ",meta:"emoji"}}))}}},v={getCompletions:function(t,o,r,a,i){var c=t.getSession().getTokenAt(r.row,r.column.count);if("undefined"!=typeof c.value){var l=c.value.split(/\s+/),s=l[l.length-1];if("@"==s[0]&&"["==s[1]){username=s.replace(/([\@\[\/\]/])/g,""),e.ajax({url:m.data("search-users-url"),data:{username:username,csrfmiddlewaretoken:n("csrftoken")},success:function(e){if(200==e.status){for(var t=[],n=0;n<e.data.length;n++)t.push("@["+e.data[n]+"]");i(null,t.map(function(e){return{caption:e,value:e+" ",meta:"users"}}))}}})}}}};e(s).find(".martor-toolbar").find(".markdown-selector").attr({"data-field-name":u}),e(s).find(".upload-progress").attr({"data-field-name":u}),e(s).find(".modal-help-guide").attr({"data-field-name":u}),e(s).find(".modal-emoji").attr({"data-field-name":u}),h.on("change",function(t){var n=h.getSession().getValue();m.val(n),m.parent().find(".invalid-feedback").remove(),m.parent().removeClass("has-error"),"true"==g.living&&n.length>0&&c(m,e(".tab-preview-"+u),!1)});var b=e(".tab-editor-"+u);b.click(function(){e(this).closest(".tab-martor-menu").find(".martor-toolbar").show()}),e(".tab-editor-"+u).click(function(){var n=e("#editor-content-"+u),o=e("#preview-content-"+u),r=e(".tab-preview-"+u);t.toggleTab(this,n,r,o)}),e(".tab-preview-"+u).click(function(){var n=e("#editor-content-"+u),o="#preview-content-"+u,r=e(".tab-editor-"+u);t.toggleTab(this,o,r,n),e(this).closest(".tab-martor-menu").find(".martor-toolbar").hide(),c(m,e(o),!0)}),"true"==g.emoji&&(langTools=ace.require("ace/ext/language_tools"),langTools.addCompleter(p)),"true"==g.mention&&(langTools=ace.require("ace/ext/language_tools"),langTools.addCompleter(v)),e(".martor-toolbar .dropdown").each(function(){var t=e(this),n=t.find(".dropdown-toggle"),o=t.find(".dropdown-menu");n.click(function(n){n.preventDefault(),n.stopPropagation(),e(".martor-toolbar .dropdown-menu").not(o).addClass("hidden"),o.toggleClass("hidden")}),e(document).click(function(e){t.is(e.target)||0!==t.has(e.target).length||o.addClass("hidden")})}),e(".markdown-help[data-field-name="+u+"]").click(function(){t.showModal(".modal-help-guide[data-field-name="+u+"]")}),e(".modal-help-guide[data-field-name="+u+"] .modal-close").click(function(){t.hideModal(".modal-help-guide[data-field-name="+u+"]")}),e(".markdown-toggle-maximize[data-field-name="+u+"]").click(function(){e(s).hasClass("main-martor-fullscreen")?(e(s).removeClass("main-martor-fullscreen"),e("body").removeClass("overflow-hidden")):(e(s).addClass("main-martor-fullscreen"),e("body").addClass("overflow-hidden"))}),e(".markdown-emoji[data-field-name="+u+"]").click(function(){var n=e(".modal-emoji[data-field-name="+u+"]"),o="undefined"!=typeof emojis?emojis:[],r=n.find(".emoji-content-body"),i=n.find(".emoji-loader-init");r.html(""),t.showElement(i),t.showModal(n),setTimeout(function(){for(var c=0;c<o.length;c++){var l=m.data("base-emoji-url")+o[c].replace(/:/g,"")+".png";r.append('<div class="inline-block p-2"><a href="javascript:void(0)" class="insert-emoji" data-emoji-target="'+o[c]+'"><img class="w-5 h-5" src="'+l+'" alt="'+o[c]+'" title="'+o[c]+'"></a></div>'),e('a[data-emoji-target="'+o[c]+'"]').click(function(){a(h,e(this).data("emoji-target")),t.hideModal(n)})}t.hideElement(i),t.showElement(r)},100)}),e(".modal-emoji[data-field-name="+u+"] .modal-close").click(function(){t.hideModal(".modal-emoji[data-field-name="+u+"]")}),h.setValue(m.val(),-1);var y=e(".upload-progress[data-field-name="+u+"]");e(s).find("input[name=markdown-image-upload]").change(function(){if(""!==e(this).val()){var o=new FormData,a=e(this)[0].files[0].name,i=e(this)[0].files[0],c=e(this)[0].files[0].size;if(c>10485760)return void alert("Image size too large. Maximum file size is 10MB.");o.append("markdown-image-upload",i),o.append("csrfmiddlewaretoken",n("csrftoken")),t.showElement(y),e.ajax({url:m.data("upload-url"),type:"POST",data:o,processData:!1,contentType:!1,beforeSend:function(){y.find(".spinner").removeClass("hidden")},success:function(e){200==e.status?r(h,a,e.image_url):alert(e.error),t.hideElement(y)},error:function(e,n,o){alert("Image upload failed: "+o),t.hideElement(y)}})}});var k={bold:function(){o(h,"**","**","Bolded text")},italic:function(){o(h,"*","*","Italicized text")},horizontal:function(){o(h,"","\n***\n","")},h1:function(){o(h,"# ","","Heading 1")},h2:function(){o(h,"## ","","Heading 2")},h3:function(){o(h,"### ","","Heading 3")},pre:function(){o(h,"```\n","\n```\n","Code goes here...")},code:function(){o(h,"`","`","Code goes here...")},quote:function(){o(h,"> ","","Quoted text")},ul:function(){o(h,"* ","","List item")},ol:function(){o(h,"1. ","","List item")},link:function(){o(h,"[","](http://)","link text")},image:function(){o(h,"![","](http://)","image text")},mention:function(){i(h)},emoji:function(){e(".markdown-emoji[data-field-name="+u+"]").trigger("click")},toggle:function(){e(".markdown-toggle-maximize[data-field-name="+u+"]").trigger("click")},help:function(){e(".markdown-help[data-field-name="+u+"]").trigger("click")}};e(s).find(".markdown-bold").click(function(){k.bold()}),e(s).find(".markdown-italic").click(function(){k.italic()}),e(s).find(".markdown-horizontal").click(function(){k.horizontal()}),e(s).find(".markdown-h1").click(function(){k.h1()}),e(s).find(".markdown-h2").click(function(){k.h2()}),e(s).find(".markdown-h3").click(function(){k.h3()}),e(s).find(".markdown-pre").click(function(){k.pre()}),e(s).find(".markdown-code").click(function(){k.code()}),e(s).find(".markdown-blockquote").click(function(){k.quote()}),e(s).find(".markdown-unordered-list").click(function(){k.ul()}),e(s).find(".markdown-ordered-list").click(function(){k.ol()}),e(s).find(".markdown-link").click(function(){k.link()}),e(s).find(".markdown-image-link").click(function(){k.image()}),e(s).find(".markdown-direct-mention").click(function(){k.mention()}),e(s).find(".markdown-emoji").click(function(){k.emoji()}),e(s).find(".markdown-toggle-maximize").click(function(){k.toggle()}),e(s).find(".markdown-help").click(function(){k.help()}),h.commands.addCommand({name:"bold",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:function(e){k.bold()},readOnly:!1}),h.commands.addCommand({name:"italic",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(e){k.italic()},readOnly:!1}),h.commands.addCommand({name:"horizontal",bindKey:{win:"Ctrl-H",mac:"Command-H"},exec:function(e){k.horizontal()},readOnly:!1}),h.commands.addCommand({name:"h1",bindKey:{win:"Ctrl-Alt-1",mac:"Command-Alt-1"},exec:function(e){k.h1()},readOnly:!1}),h.commands.addCommand({name:"h2",bindKey:{win:"Ctrl-Alt-2",mac:"Command-Alt-2"},exec:function(e){k.h2()},readOnly:!1}),h.commands.addCommand({name:"h3",bindKey:{win:"Ctrl-Alt-3",mac:"Command-Alt-3"},exec:function(e){k.h3()},readOnly:!1}),h.commands.addCommand({name:"pre",bindKey:{win:"Ctrl-Alt-P",mac:"Command-Alt-P"},exec:function(e){k.pre()},readOnly:!1}),h.commands.addCommand({name:"code",bindKey:{win:"Ctrl-Alt-C",mac:"Command-Alt-C"},exec:function(e){k.code()},readOnly:!1}),h.commands.addCommand({name:"quote",bindKey:{win:"Ctrl-Q",mac:"Command-Q"},exec:function(e){k.quote()},readOnly:!1}),h.commands.addCommand({name:"ul",bindKey:{win:"Ctrl-U",mac:"Command-U"},exec:function(e){k.ul()},readOnly:!1}),h.commands.addCommand({name:"ol",bindKey:{win:"Ctrl-Shift-O",mac:"Command-Shift-O"},exec:function(e){k.ol()},readOnly:!1}),h.commands.addCommand({name:"link",bindKey:{win:"Ctrl-L",mac:"Command-L"},exec:function(e){k.link()},readOnly:!1}),h.commands.addCommand({name:"image",bindKey:{win:"Ctrl-Shift-I",mac:"Command-Shift-I"},exec:function(e){k.image()},readOnly:!1}),h.commands.addCommand({name:"mention",bindKey:{win:"Ctrl-M",mac:"Command-M"},exec:function(e){k.mention()},readOnly:!1})})}}(jQuery);
