/**
 * Name         : Martor v1.6.45
 * Created by   : Agus Makmun (Summon Agus)
 * Release date : 15-Nov-2024
 * License      : GNU GENERAL PUBLIC LICENSE Version 3, 29 June 2007
 * Repository   : https://github.com/agusmakmun/django-markdown-editor
 * JS Minifier  : https://jscompress.com
**/
!function(D){(D=D||django.jQuery).fn.martor=function(){D(".martor").trigger("martor.init");function K(e){var n=null,o=0;if(document.cookie&&""!==document.cookie)for(var t=document.cookie.split(";");o<t.length;o++){var a=jQuery.trim(t[o]);if(a.substring(0,e.length+1)===e+"="){n=decodeURIComponent(a.substring(e.length+1));break}}return n}var A=function(e){D(e).removeClass("hidden").addClass("block")},_=function(e){D(e).removeClass("block").addClass("hidden")},H=function(e){console.log("Showing modal:",e);var n=D(e);n.removeClass("hidden").addClass("flex"),n.css({display:"flex !important","z-index":"99999",position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh",opacity:"1",visibility:"visible"}),D("body").addClass("overflow-hidden"),console.log("Modal styles applied:",n.css(["display","z-index","position"])),console.log("Modal visibility:",n.is(":visible")),console.log("Modal dimensions:",{width:n.outerWidth(),height:n.outerHeight(),offset:n.offset()}),n.find(".bg-white").css({display:"block",position:"relative","z-index":"10"}),n.show().fadeIn();var o=n.find(".bg-white").first(),e=n.find(".flex.items-center");e.css({display:"flex !important","align-items":"center","justify-content":"center",width:"100%",height:"100%","text-align":"center"}),o.css({display:"block !important",visibility:"visible",opacity:"1","background-color":"white","max-width":"800px",width:"90%","z-index":"20",margin:"0","border-radius":"8px","box-shadow":"0 25px 50px -12px rgba(0, 0, 0, 0.25)",transform:"none",position:"relative"}),console.log("Modal panel found:",o.length),console.log("Modal container found:",e.length),console.log("Modal panel styles:",o.css(["display","visibility","background-color"])),n.find("*").css("visibility","visible")},z=function(e){console.log("Hiding modal:",e),D(e).removeClass("flex").addClass("hidden").css("display","none"),D("body").removeClass("overflow-hidden")},I=function(e,n,o,t){D(o).removeClass("border-b-2 border-gray-800 text-gray-700").addClass("text-gray-500"),D(t).removeClass("block").addClass("hidden"),D(e).removeClass("text-gray-500").addClass("border-b-2 border-gray-800 text-gray-700"),D(n).removeClass("hidden").addClass("block")};this.each(function(e,n){var o=D(n),l=o.data("field-name"),r=D("#id_"+l),t="martor-"+l,c=ace.edit(t),a=JSON.parse(r.data("enable-configs").replace(/'/g,'"'));c.setTheme("ace/theme/github"),c.getSession().setMode("ace/mode/markdown"),c.getSession().setUseWrapMode(!0),c.$blockScrolling=1/0,c.renderer.setScrollMargin(10,10),c.setAutoScrollEditorIntoView(!0),c.setShowPrintMargin(!1),c.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,enableMultiselect:!1}),"true"==a.living&&D(n).addClass("enable-living");var i={getCompletions:function(e,n,o,t,a){var i="undefined"!=typeof emojis?emojis:[],o=e.getSession().getTokenAt(o.row,o.column.count);void 0===o.value||":"==(o=o.value.split(/\s+/))[o.length-1][0]&&a(null,i.map(function(e){return{caption:e,value:e.replace(":","")+" ",meta:"emoji"}}))}},s={getCompletions:function(e,n,o,t,a){o=e.getSession().getTokenAt(o.row,o.column.count);void 0===o.value||"@"==(o=(o=o.value.split(/\s+/))[o.length-1])[0]&&"["==o[1]&&(username=o.replace(/([\@\[/\]/])/g,""),D.ajax({url:r.data("search-users-url"),data:{username:username,csrfmiddlewaretoken:K("csrftoken")},success:function(e){if(200==e.status){for(var n=[],o=0;o<e.data.length;o++)n.push(e.data[o].username);a(null,n.map(function(e){return{caption:e,value:e,meta:"username"}}))}}}))}};"true"===a.mention?c.completers=[i,s]:c.completers=[i],r.attr({style:"display:none"}),D(n).find(".martor-toolbar").find(".markdown-selector").attr({"data-field-name":l}),D(n).find(".upload-progress").attr({"data-field-name":l}),D(n).find(".modal-help-guide").attr({"data-field-name":l}),D(n).find(".modal-emoji").attr({"data-field-name":l}),c.on("change",function(e){var n=c.getValue();r.val(n)});var d=D("#preview-content-"+l),n=(D(".tab-editor-"+l),D(".tab-preview-"+l)),m=D(this).closest(".tab-martor-menu").find(".martor-toolbar");D(".tab-editor-"+l).click(function(){var e=D("#editor-content-"+l),n=D("#preview-content-"+l),o=D(".tab-preview-"+l);I(this,e,o,n),D(this).closest(".tab-martor-menu").find(".martor-toolbar").show()}),D(".tab-preview-"+l).click(function(){var e=D("#editor-content-"+l),n=D("#preview-content-"+l),o=D(".tab-editor-"+l);I(this,n,o,e),D(this).closest(".tab-martor-menu").find(".martor-toolbar").hide(),u()});var u=function(){var e=r.val(),n=new FormData;n.append("content",e),n.append("csrfmiddlewaretoken",K("csrftoken")),d.addClass("martor-preview-stale"),D.ajax({url:r.data("markdownfy-url"),type:"POST",data:n,processData:!1,contentType:!1,success:function(e){e?(d.html(e).removeClass("martor-preview-stale"),d.addClass("martor-preview"),D(document).trigger("martor:preview",[d]),"true"==a.hljs&&D("pre").each(function(e,n){hljs.highlightBlock(n)})):d.html('<p class="text-gray-500">Nothing to preview</p>')},error:function(e){console.log("error",e)}})};let g;if(window.onload=function(){u()},"true"!==a.living?n.click(function(){m.hide(),u()}):c.on("change",function(){g&&clearTimeout(g),g=setTimeout(u,r.data("save-timeout"))}),"true"==a.spellcheck)try{enable_spellcheck(t)}catch(e){console.log("Spellcheck lib doesn't installed.")}"true"==a.emoji&&(langTools=ace.require("ace/ext/language_tools"),langTools.addCompleter(i)),"true"==a.mention&&(langTools=ace.require("ace/ext/language_tools"),langTools.addCompleter(s)),D(".martor-toolbar .dropdown").each(function(){var n=D(this),e=n.find(".dropdown-toggle"),o=n.find(".dropdown-menu");e.click(function(e){e.preventDefault(),e.stopPropagation(),D(".martor-toolbar .dropdown-menu").not(o).addClass("hidden"),o.toggleClass("hidden")}),D(document).click(function(e){n.is(e.target)||0!==n.has(e.target).length||o.addClass("hidden")})}),D(".markdown-help[data-field-name="+l+"]").click(function(e){e.preventDefault(),console.log("Help button clicked for field:",l);var n=".modal-help-guide[data-field-name="+l+"]";console.log("Modal selector:",n);e=D(n);console.log("Modal found:",e.length),H(n)}),D(".modal-help-guide[data-field-name="+l+"] .modal-close").click(function(e){e.preventDefault(),z(".modal-help-guide[data-field-name="+l+"]")}),D(".modal-help-guide[data-field-name="+l+"]").click(function(e){e.target!==this&&!D(e.target).hasClass("bg-gray-500")||z(".modal-help-guide[data-field-name="+l+"]")});function f(){D(document.body).removeClass("overflow-hidden"),D(this).attr({title:"Full Screen"}),D(this).find("svg.bi-arrows-angle-expand").removeClass("hidden"),D(this).find("svg.bi-arrows-angle-contract").addClass("hidden"),D(".main-martor-fullscreen").find(".martor-preview").removeAttr("style"),o.removeClass("main-martor-fullscreen"),p.removeAttr("style"),c.resize()}var p=D(".martor-field-"+l),v=D(".markdown-toggle-maximize[data-field-name="+l+"]");v.on("click",function(){!function(e){e.attr({title:"Minimize"}),e.find("svg.bi-arrows-angle-expand").addClass("hidden"),e.find("svg.bi-arrows-angle-contract").removeClass("hidden"),o.addClass("main-martor-fullscreen");var n=document.body.clientHeight-90;p.attr({style:"height:"+n+"px"}),D(".main-martor-fullscreen").find(".martor-preview").attr({style:"overflow-y: auto;height:"+n+"px"}),c.resize(),e.one("click",f),D(document.body).addClass("overflow-hidden")}(D(this))}),D(document).keyup(function(e){27==e.keyCode&&o.hasClass("main-martor-fullscreen")&&v.trigger("click")}),D(".markdown-emoji[data-field-name="+l+"]").click(function(){var t=D(".modal-emoji[data-field-name="+l+"]");H(t);var a="undefined"!=typeof emojis?emojis:[],i=t.find("#emoji-grid-"+l),s=t.find(".emoji-loader-init");0===i.children().length?(A(s),setTimeout(function(){try{console.log("Loading emojis, count:",a.length);for(var e=0;e<Math.min(a.length,300);e++){var n=a[e],o=r.data("base-emoji-url")+n.replace(/:/g,"")+".png",n=D('<button type="button" class="insert-emoji p-2 hover:bg-gray-100 rounded border border-gray-200 text-center transition-colors" data-emoji-target="'+n+'" title="'+n+'"><img class="w-6 h-6 mx-auto" src="'+o+'" alt="'+n+'" onerror="this.style.display=\'none\'; this.nextElementSibling.style.display=\'block\';"><span class="text-xs hidden">'+n+"</span></button>");i.append(n)}t.find(".insert-emoji").off("click").on("click",function(){var e=D(this).data("emoji-target");console.log("Emoji selected:",e),M(c,e),z(t)}),_(s),console.log("Emojis loaded successfully")}catch(e){console.error("Error loading emojis:",e),_(s),i.html('<div class="col-span-10 text-center text-gray-500 py-4">Error loading emojis. Please try again.</div>')}},100)):console.log("Emojis already loaded")}),D(".modal-emoji[data-field-name="+l+"] .modal-close").click(function(){z(".modal-emoji[data-field-name="+l+"]")}),D(".modal-emoji[data-field-name="+l+"] .insert-emoji-popular").click(function(){var e=D(this).data("emoji-target");M(c,e),z(".modal-emoji[data-field-name="+l+"]")}),c.setValue(r.val(),-1);function h(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o," **** "),e.focus(),e.selection.moveTo(o.row,o.column+3)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"**"+o+"**"),t.end.column+=4,e.focus(),e.selection.setSelectionRange(t))}function w(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o," __ "),e.focus(),e.selection.moveTo(o.row,o.column+2)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"_"+o+"_"),t.end.column+=2,e.focus(),e.selection.setSelectionRange(t))}function y(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o,"\n\n----------\n\n"),e.focus(),e.selection.moveTo(o.row+4,o.column+10)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"\n\n----------\n\n"+o),e.focus(),e.selection.moveTo(t.end.row+4,t.end.column+10))}function C(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o,"\n\n# "),e.focus(),e.selection.moveTo(o.row+2,o.column+2)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"\n\n# "+o+"\n"),e.focus(),e.selection.moveTo(t.end.row+2,t.end.column+2))}function k(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o,"\n\n## "),e.focus(),e.selection.moveTo(o.row+2,o.column+3)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"\n\n## "+o+"\n"),e.focus(),e.selection.moveTo(t.end.row+2,t.end.column+3))}function b(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o,"\n\n### "),e.focus(),e.selection.moveTo(o.row+2,o.column+4)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"\n\n### "+o+"\n"),e.focus(),e.selection.moveTo(t.end.row+2,t.end.column+4))}function T(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o,"\n\n```\n\n```\n"),e.focus(),e.selection.moveTo(o.row+3,o.column)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"\n\n```\n"+o+"\n```\n"),e.focus(),e.selection.moveTo(t.end.row+3,t.end.column+3))}function x(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o," `` "),e.focus(),e.selection.moveTo(o.row,o.column+2)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"`"+o+"`"),t.end.column+=2,e.focus(),e.selection.setSelectionRange(t))}function S(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o,"\n\n> \n"),e.focus(),e.selection.moveTo(o.row+2,o.column+2)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"\n\n> "+o+"\n"),e.focus(),e.selection.moveTo(t.end.row+2,t.end.column+2))}function R(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o,"\n\n* "),e.focus(),e.selection.moveTo(o.row+2,o.column+2)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"\n\n* "+o),e.focus(),e.selection.moveTo(t.end.row+2,t.end.column+2))}function j(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o,"\n\n1. "),e.focus(),e.selection.moveTo(o.row+2,o.column+3)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"\n\n1. "+o),e.focus(),e.selection.moveTo(t.end.row+2,t.end.column+3))}function O(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o," [](https://) "),e.focus(),e.selection.moveTo(o.row,o.column+2)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"["+o+"](https://) "),e.focus(),e.selection.moveTo(t.end.row,t.end.column+11))}function P(e,n){var o,t,a,i=e.getSelectionRange();void 0===n?e.selection.isEmpty()?(a=e.getCursorPosition(),e.session.insert(a," ![](https://) "),e.focus(),e.selection.moveTo(a.row,a.column+3)):(o=e.getSelectionRange(),t=e.session.getTextRange(o),e.session.replace(o,"!["+t+"](https://) "),e.focus(),e.selection.moveTo(i.end.row,i.end.column+12)):(a=e.getCursorPosition(),e.session.insert(a,"!["+n.name+"]("+n.link+") "),e.focus(),e.selection.moveTo(a.row,a.column+n.name.length+2))}function E(e){var n,o,t=e.getSelectionRange();e.selection.isEmpty()?(o=e.getCursorPosition(),e.session.insert(o," @[]"),e.focus(),e.selection.moveTo(o.row,o.column+3)):(n=e.getSelectionRange(),o=e.session.getTextRange(n),e.session.replace(n,"@["+o+"]"),e.focus(),e.selection.moveTo(t.end.row,t.end.column+3))}var M=function(e,n){var o=e.getCursorPosition();e.session.insert(o," "+n+" "),e.focus(),e.selection.moveTo(o.row,o.column+n.length+2)};D(".markdown-bold[data-field-name="+l+"]").click(function(){h(c)}),D(".markdown-italic[data-field-name="+l+"]").click(function(){w(c)}),D(".markdown-horizontal[data-field-name="+l+"]").click(function(){y(c)}),D(".markdown-h1[data-field-name="+l+"]").click(function(){C(c)}),D(".markdown-h2[data-field-name="+l+"]").click(function(){k(c)}),D(".markdown-h3[data-field-name="+l+"]").click(function(){b(c)}),D(".markdown-pre[data-field-name="+l+"]").click(function(){T(c)}),D(".markdown-code[data-field-name="+l+"]").click(function(){x(c)}),D(".markdown-blockquote[data-field-name="+l+"]").click(function(){S(c)}),D(".markdown-unordered-list[data-field-name="+l+"]").click(function(){R(c)}),D(".markdown-ordered-list[data-field-name="+l+"]").click(function(){j(c)}),D(".markdown-link[data-field-name="+l+"]").click(function(){O(c)}),D(".markdown-image-link[data-field-name="+l+"]").click(function(){P(c)});i=D(".markdown-direct-mention[data-field-name="+l+"]"),s=D(".markdown-image-upload[data-field-name="+l+"]");"true"==a.mention?i.click(function(){E(c)}):(i.remove(),D(".markdown-reference tbody tr")[1].remove()),"true"==a.imgur?s.on("change",function(e){var n,o;e.preventDefault(),n=c,e=D("#"+t).closest("form").get(0),o=n.container.id.replace("martor-",""),(e=new FormData(e)).append("csrfmiddlewaretoken",K("csrftoken")),D.ajax({url:r.data("upload-url"),type:"POST",data:e,async:!0,cache:!1,contentType:!1,enctype:"multipart/form-data",processData:!1,beforeSend:function(){console.log("Uploading..."),D(".upload-progress[data-field-name="+o+"]").show()},success:function(e){D(".upload-progress[data-field-name="+o+"]").hide(),200==e.status?(console.log(e),P(n,imageData={name:e.name,link:e.link})):alert(e.error)},error:function(e){console.log("error",e),D(".upload-progress[data-field-name="+o+"]").hide()}})}):s.remove(),c.commands.addCommand({name:"markdownToBold",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:function(e){h(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToItalic",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(e){w(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToUnderscores",bindKey:{win:"Ctrl-Shift-U",mac:"Command-Shift-U"},exec:function(e){var n,o,t;t=(n=e).getSelectionRange(),n.selection.isEmpty()?(o=n.getCursorPosition(),n.session.insert(o," ++++ "),n.focus(),n.selection.moveTo(o.row,o.column+3)):(e=n.getSelectionRange(),o=n.session.getTextRange(e),n.session.replace(e,"++"+o+"++"),t.end.column+=4,n.focus(),n.selection.setSelectionRange(t))},readOnly:!0}),c.commands.addCommand({name:"markdownToStrikethrough",bindKey:{win:"Ctrl-Shift-S",mac:"Command-Shift-S"},exec:function(e){var n,o,t;t=(n=e).getSelectionRange(),n.selection.isEmpty()?(o=n.getCursorPosition(),n.session.insert(o," ~~~~ "),n.focus(),n.selection.moveTo(o.row,o.column+3)):(e=n.getSelectionRange(),o=n.session.getTextRange(e),n.session.replace(e,"~~"+o+"~~"),t.end.column+=4,n.focus(),n.selection.setSelectionRange(t))},readOnly:!0}),c.commands.addCommand({name:"markdownToHorizontal",bindKey:{win:"Ctrl-H",mac:"Command-H"},exec:function(e){y(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToH1",bindKey:{win:"Ctrl-Alt-1",mac:"Command-Option-1"},exec:function(e){C(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToH2",bindKey:{win:"Ctrl-Alt-2",mac:"Command-Option-3"},exec:function(e){k(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToH3",bindKey:{win:"Ctrl-Alt-3",mac:"Command-Option-3"},exec:function(e){b(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToPre",bindKey:{win:"Ctrl-Alt-P",mac:"Command-Option-P"},exec:function(e){T(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToCode",bindKey:{win:"Ctrl-Alt-C",mac:"Command-Option-C"},exec:function(e){x(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToBlockQuote",bindKey:{win:"Ctrl-Q",mac:"Command-Shift-K"},exec:function(e){S(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToUnorderedList",bindKey:{win:"Ctrl-U",mac:"Command-U"},exec:function(e){R(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToOrderedList",bindKey:{win:"Ctrl-Shift+O",mac:"Command-Option-O"},exec:function(e){j(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToLink",bindKey:{win:"Ctrl-L",mac:"Command-L"},exec:function(e){O(e)},readOnly:!0}),c.commands.addCommand({name:"markdownToImageLink",bindKey:{win:"Ctrl-Shift-I",mac:"Command-Option-I"},exec:function(e){P(e)},readOnly:!0}),"true"===a.mention&&c.commands.addCommand({name:"markdownToMention",bindKey:{win:"Ctrl-M",mac:"Command-M"},exec:function(e){E(e)},readOnly:!0})})},D(function(){D(".main-martor").martor()}),"django"in window&&"jQuery"in window.django&&django.jQuery(document).on("formset:added",function(e){setTimeout(function(){var n=D(e.target);n.find(".main-martor").each(function(){var e=(e=n.attr("id")).substr(e.lastIndexOf("-")+1),e=D(this.outerHTML.replace(/__prefix__/g,e));D(this).replaceWith(e),e.martor()})},1e3)})}(jQuery);
