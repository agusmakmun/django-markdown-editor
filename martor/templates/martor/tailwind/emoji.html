{% load i18n %}

<!-- Emoji Picker Modal -->
<div class="modal-emoji hidden fixed inset-0 z-50 overflow-y-auto" data-field-name="{{ field_name }}" aria-labelledby="emoji-modal-title" role="dialog" aria-modal="true">
  <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <!-- Background overlay -->
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>

    <!-- Modal centering -->
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

    <!-- Modal panel -->
    <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <div class="flex items-start justify-between">
          <div class="flex items-center">
            <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-yellow-100 sm:mx-0 sm:h-10 sm:w-10">
              <svg class="h-6 w-6 text-yellow-600" fill="currentColor" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M8 2.748l-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
              </svg>
            </div>
            <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
              <h3 class="text-lg leading-6 font-medium text-gray-900" id="emoji-modal-title">
                {% trans "Choose an Emoji" %}
              </h3>
              <div class="mt-2">
                <p class="text-sm text-gray-500">
                  {% trans "Click on an emoji to insert it into your text" %}
                </p>
              </div>
            </div>
          </div>
          <button type="button" class="modal-close text-gray-400 hover:text-gray-600 focus:outline-none focus:text-gray-600" aria-label="{% trans 'Close' %}">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>

      <div class="bg-gray-50 px-4 py-3 sm:px-6">
        <!-- Loading indicator -->
        <div class="emoji-loader-init hidden text-center py-12">
          <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mb-4"></div>
          <p class="text-sm text-gray-500">{% trans "Loading emojis..." %}</p>
        </div>

        <!-- Search bar -->
        <div class="mb-4">
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            <input type="text"
                   id="emoji-search-{{ field_name }}"
                   class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 text-sm"
                   placeholder="{% trans 'Search emojis...' %}">
          </div>
        </div>

        <!-- Emoji categories tabs -->
        <div class="border-b border-gray-200 mb-4">
          <nav class="-mb-px flex space-x-8" aria-label="Emoji categories">
            <button class="emoji-category-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm active:border-blue-500 active:text-blue-600"
                    data-category="all">
              {% trans "All" %}
            </button>
            <button class="emoji-category-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"
                    data-category="smileys">
              üòä {% trans "Smileys" %}
            </button>
            <button class="emoji-category-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"
                    data-category="people">
              üë• {% trans "People" %}
            </button>
            <button class="emoji-category-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"
                    data-category="nature">
              üåø {% trans "Nature" %}
            </button>
            <button class="emoji-category-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"
                    data-category="objects">
              üéØ {% trans "Objects" %}
            </button>
          </nav>
        </div>

        <!-- Emoji grid -->
        <div class="emoji-content-body">
          <div class="max-h-64 overflow-y-auto">
            <div class="grid grid-cols-8 gap-2" id="emoji-grid-{{ field_name }}">
              <!-- Emojis will be dynamically loaded here -->
            </div>
          </div>
        </div>

        <!-- Popular emojis section -->
        <div class="mt-4 pt-4 border-t border-gray-200">
          <h4 class="text-sm font-medium text-gray-900 mb-2">{% trans "Popular" %}</h4>
          <div class="flex flex-wrap gap-1">
            <button type="button" class="insert-emoji p-1 hover:bg-gray-100 rounded" data-emoji-target=":smile:" title="smile">
              <span class="text-lg">üòä</span>
            </button>
            <button type="button" class="insert-emoji p-1 hover:bg-gray-100 rounded" data-emoji-target=":heart:" title="heart">
              <span class="text-lg">‚ù§Ô∏è</span>
            </button>
            <button type="button" class="insert-emoji p-1 hover:bg-gray-100 rounded" data-emoji-target=":thumbsup:" title="thumbs up">
              <span class="text-lg">üëç</span>
            </button>
            <button type="button" class="insert-emoji p-1 hover:bg-gray-100 rounded" data-emoji-target=":thumbsdown:" title="thumbs down">
              <span class="text-lg">üëé</span>
            </button>
            <button type="button" class="insert-emoji p-1 hover:bg-gray-100 rounded" data-emoji-target=":fire:" title="fire">
              <span class="text-lg">üî•</span>
            </button>
            <button type="button" class="insert-emoji p-1 hover:bg-gray-100 rounded" data-emoji-target=":star:" title="star">
              <span class="text-lg">‚≠ê</span>
            </button>
            <button type="button" class="insert-emoji p-1 hover:bg-gray-100 rounded" data-emoji-target=":thinking:" title="thinking">
              <span class="text-lg">ü§î</span>
            </button>
            <button type="button" class="insert-emoji p-1 hover:bg-gray-100 rounded" data-emoji-target=":tada:" title="celebration">
              <span class="text-lg">üéâ</span>
            </button>
          </div>
        </div>
      </div>

      <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
        <button type="button" class="modal-close w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
          {% trans "Close" %}
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// Enhanced emoji search and filtering functionality
(function() {
    // Search functionality
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('emoji-search-{{ field_name }}');
        if (searchInput) {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const emojiButtons = document.querySelectorAll('#emoji-grid-{{ field_name }} .insert-emoji');

                emojiButtons.forEach(function(button) {
                    const emojiName = button.getAttribute('data-emoji-target').toLowerCase();
                    const emojiTitle = button.getAttribute('title').toLowerCase();

                    if (emojiName.includes(searchTerm) || emojiTitle.includes(searchTerm)) {
                        button.parentElement.style.display = 'block';
                    } else {
                        button.parentElement.style.display = 'none';
                    }
                });
            });
        }

        // Category tab functionality
        const categoryTabs = document.querySelectorAll('.emoji-category-tab');
        categoryTabs.forEach(function(tab) {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                categoryTabs.forEach(function(t) {
                    t.classList.remove('border-blue-500', 'text-blue-600');
                    t.classList.add('border-transparent', 'text-gray-500');
                });

                // Add active class to clicked tab
                this.classList.remove('border-transparent', 'text-gray-500');
                this.classList.add('border-blue-500', 'text-blue-600');

                // Filter emojis by category (this would need to be implemented based on emoji data structure)
                const category = this.getAttribute('data-category');
                // Filter logic would go here
            });
        });
    });
})();
</script>
